<!--
`nuxeo-retentionconfig-edit-layout`
@group Nuxeo UI
@element nuxeo-retentionconfig-edit-layout
-->
<dom-module id="nuxeo-retentionconfig-edit-layout">
  <template>
    <style include="iron-flex iron-flex-alignment nuxeo-styles">
      *[role=widget] {
          padding: 5px;
      }

      hidden {
        display: none;
      }

      nuxeo-card {
        padding-left: 0;
      }

      label.in-card {
        padding-top: 5px;
        padding-left: 15px;
        margin-left: 15px;
        margin-right: 10px;
        font-weight: 600 !important;
        border-left-style: solid;
        border-left-width: thin;
      }

      .textSeparator {
        padding-top: 5px;
        margin-left: 20px;
        margin-right: 20px;
        font-weight: 600;
      }
      </style>
    <nuxeo-card heading="Info">
      <nuxeo-input role="widget" value="{{document.properties.dc:title}}" label="Title" type="text"></nuxeo-input>

      <nuxeo-input role="widget" value="{{document.properties.dc:description}}" label="Description" type="text"></nuxeo-input>
    </nuxeo-card>

    <nuxeo-card heading="Retention Context">
      <nuxeo-directory-suggestion
              role="widget"
              value="{{document.properties.retentionconfig:docTypes}}"
              label="Types"
              multiple="true"
              directory-name="RetentionDoctypes"
              min-chars="0"></nuxeo-directory-suggestion>

      <nuxeo-directory-suggestion
              role="widget"
              value="{{document.properties.retentionconfig:facets}}"
              label="Facets"
              multiple="true"
              directory-name="RetentionFacets"
              min-chars="0"></nuxeo-directory-suggestion>

      <nuxeo-directory-suggestion
              role="widget" 
              value="{{document.properties.retentionconfig:states}}"
              label="States" multiple="true"
              directory-name="RetentionStates"
              min-chars="0"></nuxeo-directory-suggestion>
    </nuxeo-card>

    <nuxeo-card heading="Retention Delay">
      <div class="layout horizontal flex">
        <nuxeo-input role="widget"
                      value="{{document.properties.retentionconfig:delayDays}}"
                      on-input="_delayDuration"
                      label="Days"
                      min="0"
                      type="number"></nuxeo-input>
        <nuxeo-input role="widget"
                      value="{{document.properties.retentionconfig:delayMonths}}"
                      on-input="_delayDuration"
                      label="Months"
                      min="0"
                      type="number"></nuxeo-input>
        <nuxeo-input role="widget"
                      value="{{document.properties.retentionconfig:delayYears}}"
                      on-input="_delayDuration"
                      label="Years"
                      min="0"
                      type="number"></nuxeo-input>
        <nuxeo-input id="DelayPeriod"
                      role="widget"
                      value="{{document.properties.rule:beginDelayPeriod}}"
                      label="Delay Period"
                      type="text"
                      readonly="true"></nuxeo-input>
      </div>
    </nuxeo-card>

    <nuxeo-card heading="Retention Duration">
      <div class="layout horizontal flex">
        <nuxeo-input role="widget"
                      value="{{document.properties.retentionconfig:durationYears}}"
                      on-input="_retentionDuration"
                      min="0"
                      label="Years"
                      type="number"></nuxeo-input>
        <nuxeo-input role="widget"
                      value="{{document.properties.retentionconfig:durationMonths}}"
                      on-input="_retentionDuration"
                      min="0"
                      label="Months"
                      type="number"></nuxeo-input>
        <nuxeo-input role="widget"
                      value="{{document.properties.retentionconfig:durationDays}}"
                      on-input="_retentionDuration"
                      min="0"
                      label="Days"
                      type="number"></nuxeo-input>
        <nuxeo-input id="DurationPeriod"
                      role="widget"
                      value="{{document.properties.rule:retentionDurationPeriod}}"
                      label="Duration Period"
                      type="text"
                      readonly="true"></nuxeo-input>
      </div>
    </nuxeo-card>

    <nuxeo-card heading="Retention Begin">
      <div class="layout horizontal flex">
        <nuxeo-input role="widget"
                      value="{{document.properties.rule:retentionReminderInDays}}"
                      label="Reminder Days"
                      min="0"
                      type="number"></nuxeo-input>
        <label class="in-card">Begin Condition:</label>
        <nuxeo-input role="widget"
                      style="min-width: 300px"
                      value="{{document.properties.rule:beginCondition.expression}}"
                      label="Expression (EL)"
                      type="text"></nuxeo-input>
        <nuxeo-input role="widget"
                      value="{{document.properties.rule:beginCondition.event}}"
                      label="Event"
                      type="text"></nuxeo-input>
      </div>
      <div class="layout horizontal flex" style="margin-top: 20px;">
          <nuxeo-input role="widget"
                        value="{{document.properties.rule:beginAction}}"
                        label="Begin Action (Automation Chain)"
                        type="text"></nuxeo-input>
          <div class="textSeparator">OR</div>
          <nuxeo-directory-suggestion
                    style="min-width: 400px"
                    role="widget"
                    value="{{document.properties.retentionconfig:beginActions}}"
                    label="Predefined Begin Action(s)"
                    multiple="true"
                    directory-name="RetentionBegin"
                    min-chars="0"></nuxeo-directory-suggestion>
      </div>

    </nuxeo-card>

    <nuxeo-card heading="Retention End">
    <!--
    <nuxeo-input role="widget"
                  value="{{document.properties.rule:endAction}}"
                  label="End Action"
                  type="text"></nuxeo-input>
    -->
    <nuxeo-directory-suggestion
                  role="widget"
                  value="{{document.properties.retentionconfig:endActions}}"
                  label="Predefined Begin End Action(s)"
                  multiple="true"
                  directory-name="RetentionEnd"
                  min-chars="0"></nuxeo-directory-suggestion>


    <label>End Condition</label>
    <div class="layout horizontal flex">
      <nuxeo-input role="widget"
                    value="{{document.properties.rule:endCondition.expression}}"
                    label="Expression (EL)"
                    type="text"></nuxeo-input>
      <nuxeo-input role="widget"
                    value="{{document.properties.rule:endCondition.event}}"
                    label="Event"
                    type="text"></nuxeo-input>
    </div>
  </nuxeo-card>

  </template>

  <script>
    Polymer({
      is: 'nuxeo-retentionconfig-edit-layout',
      behaviors: [Nuxeo.LayoutBehavior],
      properties: {

        /**
         * @doctype RetentionConfig
         */
        document: {
          type: Object,
        },

      },

      _period: function (value, part) {
        if (value && value > 0) {
          return value + part;
        }
        return "";
      },

      _retentionDuration: function () {
        var duration = "P";
        duration += this._period(this.document.properties["retentionconfig:durationYears"], "Y");
        duration += this._period(this.document.properties["retentionconfig:durationMonths"], "M");
        duration += this._period(this.document.properties["retentionconfig:durationDays"], "D");

        if (duration === "P") {
          duration = null;
        }
        this.$.DurationPeriod.value = duration;
      },

      _delayDuration: function () {
        var duration = "P";
        duration += this._period(this.document.properties["retentionconfig:delayYears"], "Y");
        duration += this._period(this.document.properties["retentionconfig:delayMonths"], "M");
        duration += this._period(this.document.properties["retentionconfig:delayDays"], "D");

        if (duration === "P") {
          duration = null;
        }
        this.$.DelayPeriod.value = duration;
      }
    });

  </script>
</dom-module>
